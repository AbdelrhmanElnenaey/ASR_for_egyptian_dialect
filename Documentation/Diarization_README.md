# <a name="diarization-for-egyptian-dialect"></a> Diarization for Egyptian Dialect

This file is a documentation for the work exerted in diarization process for Egyptian dialect, experments done, insights gained, approaches selected and results obtained so, make a cup of coffee and have fun


## Table of Contents
- [Diarization for Egyptian Dialect](#diarization-for-egyptian-dialect)
  * [Introduction](#introduction)
  * [Experiments on sample data](#experiment-sample-data)
    + [PCA experiments](#pca-experiments)
    + [Embedding models experiments](#embedding-models-experiments)
    + [Window size experiments](#window-size-experiments)
    + [Insights](#insights)
  * [Datasets Exploration](#datasets-exploration)
  * [Experiments on callhome test data](#experiments-callhome)
    + [Insights](#insights)
  * [Dataset collection and synthsis trials](#dataset-collection-synthsis-trials)
  * [Insights](#insights)
  * [Contributors](#contributors)
  * [Supervisor](#supervisor)
  * [References](#references)
 
## <a name="introduction"></a> Introduction
Speaker Diarization is the task of segmenting and co-indexing audio recordings by speaker. in other words, diarization implies finding speaker boundaries and grouping segments that belong to the same speaker, and, as a by-product, determining the number of distinct speakers. the goal is not to identify known speakers, but to co-index segments that are attributed to the same speaker.

### Current Aprroaches
Current approaches for speaker diarization can be summarized in two main approaches: Multi-stage (pipeline) and End to End speaker diarization
<div>
<img src = "https://github.com/user-attachments/assets/ab612ca6-de15-4a76-a9fc-4f8a0a794e0b" width="50%">
<img src = "https://github.com/user-attachments/assets/f7ff23d0-d29b-4fac-9362-d69c54bd903f" width="50%">
</div>

Having a scarcity in the arabic rather than the eqyptian training data and finding that the End to end approach is still not mature, we managed to go through a multi-stage (pipeline) approach 

We started with an initial pipline having the following components:
  * Whisper large model for speech activity and change detection: it outputs the starts and ends of the audio segments to extract the embedding
  * Ecapa speech embedding model
  * Agglomorative Clustering where the number of speakers must be known in advance

## <a name="experiments-sample-data"></a> Experiments on sample data
We constructed our first experiments on the provided sample audio with its correponding annotation.

### <a name="pca-experiments"></a> PCA experiments
First we conducted an experiment testing the pipeline performance on different clustering algorithms with and without PCA
The pipeline with pca refers to doing principle component analysis (PCA) on the generated embeddings by the embedding model before doing the clustering

The results in the table represents the DER value without overlap
|       | Agglomorative     | Mean Shift      | DBscan    |
|-------|-------------------|-----------------|-----------|
| without PCA  | 0.265  | 0.416  | 0.416  |
| with PCA  | 0.272  | 0.275  | 0.261  | 

### <a name="embedding-models-experiments"></a> Embedding Models experiments
We then conducted an experiment testing different embedding models performance including (speakerverification_en_titanet_large, spkrec-ecapa-voxceleb, wespeaker-voxceleb-resnet34-LM) and combinations between them
In this experiment we used Agglomorative clustering with number of clusters computed using Automated Elbow method

|    | Tita Net   | Ecapa   | ResNet34   | Tita Net and Ecapa   | Tita Net and RestNet34   |  Ecapa and ResNet34  |
|----|------------|------------|------------|------------|------------|------------|
| DER with Overlap | 0.252 | 0.237 | 0.271 | 0.229 | 0.251 | 0.243 |
| DER without Overlap | 0.249 | 0.233 | 0.268 | 0.226 | 0.248 | 0.239 |

Some Qualitative Results for each model:

<table>
  <tr>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/f50768e6-a7fa-44e8-bf9a-cd4eae682934" width="50%">
      <p>Scatter plot for PCA of the embedding generated by Tita Net</p>
    </td>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/5c5edc51-d926-454d-bc35-a3c58b1e7996" width="50%">
      <p>Scatter plot for the resulted clustering</p>
    </td>
  </tr>
</table>

<table>
  <tr>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/a2ca1f55-0bba-40f9-8399-764837567bc1" width="50%">
      <p>Scatter plot for PCA of the embedding generated by Ecapa</p>
    </td>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/ed1f56ba-e217-4c8e-b7b5-8f0336383258" width="50%">
      <p>Scatter plot for the resulted clustering</p>
    </td>
  </tr>
</table>


<table>
  <tr>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/0ca85df4-89b3-42ea-8d30-f91862fe0113" width="50%">
      <p>Scatter plot for PCA of the embedding generated by ResNet34 Net</p>
    </td>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/2362407b-fabd-4a53-a500-f9eef76bc575" width="50%">
      <p>Scatter plot for the resulted clustering</p>
    </td>
  </tr>
</table>

<table>
  <tr>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/9967c915-0b36-42ff-8035-8ffb5d13c183" width="50%">
      <p>Scatter plot for PCA of the embedding generated by </p>
    </td>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/68e28aa8-b5db-48ec-a4de-e8cf7b829529" width="50%">
      <p>Scatter plot for the resulted clustering</p>
    </td>
  </tr>
</table>

<table>
  <tr>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/f88235e9-3985-4826-a182-8b1f40b008eb" width="50%">
      <p>Scatter plot for PCA of the embedding generated by the concatenation between Tita Net and ResNet34</p>
    </td>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/beab2516-704c-4054-abcb-7a2b04ed414e" width="50%">
      <p>Scatter plot for the resulted clustering</p>
    </td>
  </tr>
</table>

<table>
  <tr>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/8c10c5f9-f02a-4c3f-a61b-85ea3a8bd77c" width="50%">
      <p>Scatter plot for PCA of the embedding generated by the concatenation between Ecapa and ResNet34</p>
    </td>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/269fd340-61a2-4cf1-b892-1cde1ab84dd0" width="50%">
      <p>Scatter plot for the resulted clustering</p>
    </td>
  </tr>
</table>



## Contributors
- [Abdelrahman Elnenaey](https://github.com/AbdelrhmanElnenaey)
- [Rana Barakat](https://github.com/ranabarakat)
- [Louai Zahran](https://github.com/LouaiZahran)

## Supervisor
- [Ismail El-Yamany](https://github.com/IsmailElYamany)

## References
- [Improving Diarization Robustness using Diversification, Randomization and the DOVER Algorithm](https://arxiv.org/abs/1910.11691)
